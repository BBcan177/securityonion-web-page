#!/bin/sh

set -e

case "$1" in
    install|upgrade)
    
        # We previously modified /etc/apache2/mods-enabled/ssl.conf directly.
        # This broke the symlink, so we need to repair it.
        FILE="/etc/apache2/mods-enabled/ssl.conf"
        if [ -e $FILE ]; then
                if [ -L $FILE ]; then
                        echo "Verified that $FILE is a proper symlink."
                else
                        echo "$FILE is not a proper symlink."
                        BACKUP="/etc/apache2/ssl.conf.$(date +%Y%m%d)"
                        echo "Moving $FILE to $BACKUP."
                        mv $FILE $BACKUP || echo "Error moving $FILE."
                        echo "Re-enabling SSL module, fixing symlink."
                        /usr/sbin/a2enmod ssl || echo "Error enabling SSL."
                fi
        fi

    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
